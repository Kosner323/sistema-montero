<!doctype html>
<html lang="es" data-pc-preset="preset-1" data-pc-sidebar-caption="true" data-pc-direction="ltr" dir="ltr" data-pc-theme="light">
<head>
    <meta charset="utf-8" />
    <title>Explorador de Archivos | Portal Montero</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="icon" href="/assets/images/favicon.svg" type="image/x-icon" />

    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="/assets/fonts/phosphor/duotone/style.css" />
    <link rel="stylesheet" href="/assets/fonts/tabler-icons.min.css" />
    <link rel="stylesheet" href="/assets/fonts/feather.css" />
    <link rel="stylesheet" href="/assets/fonts/fontawesome.css" />
    <link rel="stylesheet" href="/assets/fonts/material.css" />
    <link rel="stylesheet" href="/assets/css/style.css" id="main-style-link" />
    <!-- ‚úÖ REDISE√ëO CORPORATIVO ENTERPRISE -->
    <link rel="stylesheet" href="/assets/css/corporate-redesign.css" />

    <style>
        /* Barra de b√∫squeda superior */
        .search-bar-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .search-input-large {
            height: 50px;
            font-size: 1.1rem;
            border-radius: 25px;
            padding-left: 50px;
            border: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .search-icon-large {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
            color: #6c757d;
        }

        /* Contenedor principal de dos columnas */
        .explorer-container {
            display: flex;
            gap: 0;
            height: calc(100vh - 300px);
            min-height: 500px;
        }

        /* Panel izquierdo - √Årbol de carpetas */
        .tree-panel {
            width: 300px;
            border-right: 2px solid #e5e7eb;
            overflow-y: auto;
            background: #f9fafb;
            padding: 15px;
        }

        .tree-panel ul {
            list-style: none;
            padding-left: 0;
        }

        .tree-panel ul ul {
            padding-left: 20px;
        }

        .tree-item {
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 6px;
            margin-bottom: 4px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tree-item:hover {
            background: #e0e7ff;
        }

        .tree-item.active {
            background: #4680ff;
            color: white;
            font-weight: 600;
        }

        .tree-item i {
            width: 20px;
            height: 20px;
        }

        .folder-icon {
            color: #f59e0b;
        }

        .tree-item.active .folder-icon {
            color: #fef3c7;
        }

        .expand-icon {
            width: 16px;
            height: 16px;
            transition: transform 0.2s;
        }

        .expand-icon.expanded {
            transform: rotate(90deg);
        }

        /* Panel derecho - Vista de archivos */
        .files-panel {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: white;
        }

        .breadcrumb-nav {
            margin-bottom: 20px;
            padding: 10px;
            background: #f3f4f6;
            border-radius: 6px;
        }

        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
        }

        .file-card {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .file-card:hover {
            border-color: #4680ff;
            box-shadow: 0 4px 12px rgba(70, 128, 255, 0.2);
            transform: translateY(-4px);
        }

        .file-icon-large {
            font-size: 48px;
            margin-bottom: 10px;
            color: #dc2626;
        }

        .file-icon-large.folder {
            color: #f59e0b;
        }

        .file-card-name {
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .file-card-date {
            font-size: 0.75rem;
            color: #6b7280;
        }

        /* Preview Panel (Opcional) */
        .preview-panel {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -4px 0 10px rgba(0,0,0,0.1);
            transition: right 0.3s;
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .preview-panel.active {
            right: 0;
        }

        .preview-close {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            font-size: 24px;
        }
    </style>
</head>
<body>
    <div class="loader-bg fixed inset-0 bg-white dark:bg-themedark-cardbg z-[1034]">
        <div class="loader-track h-[5px] w-full inline-block absolute overflow-hidden top-0">
            <div class="loader-fill w-[300px] h-[5px] bg-primary-500 absolute top-0 left-0 animate-[hitZak_0.6s_ease-in-out_infinite_alternate]"></div>
        </div>
    </div>

    {% include '_sidebar.html' %}
    {% include '_header.html' %}

    <div class="pc-container">
        <div class="pc-content">
            <div class="page-header">
                <div class="page-block">
                    <div class="page-header-title">
                        <h5 class="mb-0 font-medium">üìÅ Explorador de Archivos</h5>
                    </div>
                    <ul class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/dashboard">Home</a></li>
                        <li class="breadcrumb-item"><a href="#">Administraci√≥n</a></li>
                        <li class="breadcrumb-item" aria-current="page">Explorador de Archivos</li>
                    </ul>
                </div>
            </div>

            <!-- Barra de B√∫squeda Superior -->
            <div class="search-bar-container">
                <div class="position-relative">
                    <i data-feather="search" class="search-icon-large"></i>
                    <input type="text" class="form-control search-input-large" id="searchInput" 
                           placeholder="üîç Buscar Documento de Usuario...">
                </div>
            </div>

            <!-- Contenedor de Dos Paneles -->
            <div class="card">
                <div class="card-body p-0">
                    <div class="explorer-container">
                        <!-- Panel Izquierdo: √Årbol de Carpetas -->
                        <div class="tree-panel">
                            <h6 class="mb-3 fw-bold text-muted">üìÇ ESTRUCTURA DE ARCHIVOS</h6>
                            <ul id="folderTree">
                                <!-- Se llenar√° din√°micamente -->
                            </ul>
                        </div>

                        <!-- Panel Derecho: Vista de Archivos -->
                        <div class="files-panel">
                            <div class="breadcrumb-nav">
                                <nav aria-label="breadcrumb">
                                    <ol class="breadcrumb mb-0" id="fileBreadcrumb">
                                        <li class="breadcrumb-item active">Home</li>
                                    </ol>
                                </nav>
                            </div>

                            <h6 class="mb-3 fw-bold" id="currentFolderTitle">üìã Todos los Archivos</h6>

                            <div class="files-grid" id="filesGrid">
                                <!-- Se llenar√° din√°micamente -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    {% include '_footer.html' %}

    <!-- Panel de Preview (Opcional) -->
    <div class="preview-panel" id="previewPanel">
        <i data-feather="x" class="preview-close" id="closePreview"></i>
        <h5 class="mb-3">Vista Previa</h5>
        <div id="previewContent">
            <p class="text-muted">Selecciona un archivo para previsualizarlo</p>
        </div>
    </div>

    <script src="/assets/js/plugins/simplebar.min.js"></script>
    <script src="/assets/js/plugins/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/icon/custom-icon.js"></script>
    <script src="/assets/js/plugins/feather.min.js"></script>
    <script src="/assets/js/component.js"></script>
    <script src="/assets/js/theme.js"></script>
    <script>
        // --- POLYFILLS PARA TEMA ---
        window.layout_change = window.layout_change || function() {};
        window.layout_theme_sidebar_change = window.layout_theme_sidebar_change || function() {};
        window.change_box_container = window.change_box_container || function() {};
        window.layout_caption_change = window.layout_caption_change || function() {};
        window.layout_rtl_change = window.layout_rtl_change || function() {};
        window.preset_change = window.preset_change || function() {};
        window.main_layout_change = window.main_layout_change || function() {};
    </script>
    <script src="/assets/js/script.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const loader = document.querySelector('.loader-bg');
            if (loader) loader.style.display = 'none';

            // üìä DATOS SIMULADOS - Estructura de Carpetas y Archivos
            const fileStructure = [
                {
                    id: 1,
                    name: 'Kevin Montero',
                    type: 'folder',
                    icon: 'user',
                    children: [
                        {
                            id: 2,
                            name: '2025',
                            type: 'folder',
                            icon: 'calendar',
                            children: [
                                {
                                    id: 3,
                                    name: 'Recibos',
                                    type: 'folder',
                                    icon: 'file-text',
                                    files: [
                                        { id: 101, name: 'Recibo_Enero.pdf', date: '2025-01-15', size: '245 KB' },
                                        { id: 102, name: 'Recibo_Febrero.pdf', date: '2025-02-15', size: '238 KB' }
                                    ]
                                },
                                {
                                    id: 4,
                                    name: 'Planillas PILA',
                                    type: 'folder',
                                    icon: 'database',
                                    files: [
                                        { id: 103, name: 'Planilla_Enero_2025.pdf', date: '2025-01-20', size: '512 KB' },
                                        { id: 104, name: 'Planilla_Febrero_2025.pdf', date: '2025-02-20', size: '498 KB' }
                                    ]
                                },
                                {
                                    id: 5,
                                    name: 'Certificados',
                                    type: 'folder',
                                    icon: 'award',
                                    files: [
                                        { id: 105, name: 'Certificado_Ingresos_2025.pdf', date: '2025-01-10', size: '128 KB' }
                                    ]
                                }
                            ]
                        },
                        {
                            id: 6,
                            name: '2024',
                            type: 'folder',
                            icon: 'calendar',
                            children: [
                                {
                                    id: 7,
                                    name: 'Recibos',
                                    type: 'folder',
                                    icon: 'file-text',
                                    files: [
                                        { id: 106, name: 'Recibo_Diciembre.pdf', date: '2024-12-15', size: '232 KB' }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    id: 8,
                    name: 'Mar√≠a Garc√≠a',
                    type: 'folder',
                    icon: 'user',
                    children: [
                        {
                            id: 9,
                            name: '2025',
                            type: 'folder',
                            icon: 'calendar',
                            children: [
                                {
                                    id: 10,
                                    name: 'Recibos',
                                    type: 'folder',
                                    icon: 'file-text',
                                    files: [
                                        { id: 107, name: 'Recibo_Enero.pdf', date: '2025-01-15', size: '241 KB' }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ];

            let currentFolder = null;
            let currentFiles = [];

            // üå≥ RENDERIZAR √ÅRBOL DE CARPETAS
            function renderTree(items, parentElement, level = 0) {
                items.forEach(item => {
                    const li = document.createElement('li');
                    
                    const div = document.createElement('div');
                    div.className = 'tree-item';
                    div.dataset.folderId = item.id;
                    
                    if (item.children && item.children.length > 0) {
                        const expandIcon = document.createElement('i');
                        expandIcon.setAttribute('data-feather', 'chevron-right');
                        expandIcon.className = 'expand-icon';
                        div.appendChild(expandIcon);
                    } else {
                        const spacer = document.createElement('span');
                        spacer.style.width = '16px';
                        spacer.style.display = 'inline-block';
                        div.appendChild(spacer);
                    }
                    
                    const icon = document.createElement('i');
                    icon.setAttribute('data-feather', item.icon || 'folder');
                    icon.className = 'folder-icon';
                    div.appendChild(icon);
                    
                    const text = document.createElement('span');
                    text.textContent = item.name;
                    div.appendChild(text);
                    
                    li.appendChild(div);
                    
                    if (item.children && item.children.length > 0) {
                        const ul = document.createElement('ul');
                        ul.style.display = 'none';
                        renderTree(item.children, ul, level + 1);
                        li.appendChild(ul);
                        
                        // Toggle expand/collapse
                        div.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const subList = li.querySelector('ul');
                            const expandIcon = div.querySelector('.expand-icon');
                            if (subList) {
                                if (subList.style.display === 'none') {
                                    subList.style.display = 'block';
                                    expandIcon.classList.add('expanded');
                                } else {
                                    subList.style.display = 'none';
                                    expandIcon.classList.remove('expanded');
                                }
                            }
                            
                            // Highlight active folder
                            document.querySelectorAll('.tree-item').forEach(el => el.classList.remove('active'));
                            div.classList.add('active');
                            
                            // Load files
                            loadFiles(item);
                            
                            feather.replace();
                        });
                    } else {
                        div.addEventListener('click', (e) => {
                            e.stopPropagation();
                            document.querySelectorAll('.tree-item').forEach(el => el.classList.remove('active'));
                            div.classList.add('active');
                            loadFiles(item);
                        });
                    }
                    
                    parentElement.appendChild(li);
                });
                
                feather.replace();
            }

            // üìÑ CARGAR ARCHIVOS DE UNA CARPETA
            function loadFiles(folder) {
                currentFolder = folder;
                const filesGrid = document.getElementById('filesGrid');
                const currentFolderTitle = document.getElementById('currentFolderTitle');
                
                currentFolderTitle.textContent = `üìÅ ${folder.name}`;
                
                filesGrid.innerHTML = '';
                
                // Mostrar subcarpetas
                if (folder.children && folder.children.length > 0) {
                    folder.children.forEach(child => {
                        const card = createFolderCard(child);
                        filesGrid.appendChild(card);
                    });
                }
                
                // Mostrar archivos
                if (folder.files && folder.files.length > 0) {
                    folder.files.forEach(file => {
                        const card = createFileCard(file);
                        filesGrid.appendChild(card);
                    });
                } else if (!folder.children || folder.children.length === 0) {
                    filesGrid.innerHTML = '<p class="text-muted">üìÇ Carpeta vac√≠a</p>';
                }
            }

            // üìÅ CREAR TARJETA DE CARPETA
            function createFolderCard(folder) {
                const div = document.createElement('div');
                div.className = 'file-card';
                div.innerHTML = `
                    <i data-feather="folder" class="file-icon-large folder"></i>
                    <div class="file-card-name">${folder.name}</div>
                    <div class="file-card-date">Carpeta</div>
                `;
                
                div.addEventListener('click', () => {
                    loadFiles(folder);
                });
                
                feather.replace();
                return div;
            }

            // üìÑ CREAR TARJETA DE ARCHIVO
            function createFileCard(file) {
                const div = document.createElement('div');
                div.className = 'file-card';
                div.innerHTML = `
                    <i data-feather="file-text" class="file-icon-large"></i>
                    <div class="file-card-name">${file.name}</div>
                    <div class="file-card-date">${file.date} ‚Ä¢ ${file.size}</div>
                `;
                
                div.addEventListener('click', () => {
                    previewFile(file);
                });
                
                feather.replace();
                return div;
            }

            // üëÅÔ∏è VISTA PREVIA DE ARCHIVO
            function previewFile(file) {
                const previewPanel = document.getElementById('previewPanel');
                const previewContent = document.getElementById('previewContent');
                
                previewContent.innerHTML = `
                    <div class="text-center mb-3">
                        <i data-feather="file-text" style="width: 64px; height: 64px; color: #dc2626;"></i>
                    </div>
                    <h6 class="fw-bold">${file.name}</h6>
                    <p class="text-muted mb-3">Fecha: ${file.date}</p>
                    <p class="text-muted mb-3">Tama√±o: ${file.size}</p>
                    <iframe src="/uploads/${file.name}" width="100%" height="400" style="border: 1px solid #e5e7eb; border-radius: 6px;"></iframe>
                    <div class="mt-3">
                        <button class="btn btn-primary btn-sm w-100">
                            <i data-feather="download"></i> Descargar
                        </button>
                    </div>
                `;
                
                previewPanel.classList.add('active');
                feather.replace();
            }

            // üîç B√öSQUEDA DE ARCHIVOS
            document.getElementById('searchInput').addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                console.log('üîç Buscando:', searchTerm);
                
                // Implementar l√≥gica de b√∫squeda
                if (searchTerm.length > 0) {
                    // Filtrar archivos que coincidan
                    const filesGrid = document.getElementById('filesGrid');
                    const cards = filesGrid.querySelectorAll('.file-card');
                    cards.forEach(card => {
                        const name = card.querySelector('.file-card-name').textContent.toLowerCase();
                        if (name.includes(searchTerm)) {
                            card.style.display = 'block';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                }
            });

            // ‚ùå CERRAR PREVIEW
            document.getElementById('closePreview').addEventListener('click', () => {
                document.getElementById('previewPanel').classList.remove('active');
            });

            // üöÄ INICIALIZAR
            const folderTree = document.getElementById('folderTree');
            renderTree(fileStructure, folderTree);
            
            // Cargar archivos iniciales (todos)
            const allFiles = [];
            function collectFiles(items) {
                items.forEach(item => {
                    if (item.files) allFiles.push(...item.files);
                    if (item.children) collectFiles(item.children);
                });
            }
            collectFiles(fileStructure);
            
            console.log('‚úÖ Explorador de archivos cargado con', allFiles.length, 'archivos');
        });
    </script>

    {% include '_theme_config.html' %}
</body>
</html>
