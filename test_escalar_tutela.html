<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Bot√≥n Escalar a Tutela</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Feather Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.css">
    
    <style>
        /* Badges de estado */
        .badge-status-en-proceso { background-color: #ffc107; color: #000; }
        .badge-status-pagada { background-color: #28a745; color: #fff; }
        .badge-status-rechazada { background-color: #dc3545; color: #fff; }
        
        /* Estilo para bot√≥n de escalar a tutela */
        .btn-escalar-tutela {
            background-color: #6f42c1; /* P√∫rpura */
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        .btn-escalar-tutela:hover {
            background-color: #5a32a3;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(111, 66, 193, 0.3);
        }
        .btn-escalar-tutela i {
            width: 16px;
            height: 16px;
        }
        
        body {
            background-color: #f8f9fa;
        }
        
        .demo-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    
    <div class="container mt-5">
        <div class="demo-card p-4 mb-4">
            <h2 class="mb-4">üß™ Prueba Visual: Bot√≥n "Escalar a Tutela"</h2>
            <p class="text-muted">Esta tabla muestra c√≥mo se ver√° el bot√≥n de escalar a tutela en diferentes estados de incapacidad.</p>
        </div>
        
        <div class="demo-card p-4">
            <h5 class="mb-3">Tabla de Incapacidades (Simulaci√≥n)</h5>
            
            <div class="table-responsive">
                <table class="table table-hover table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>Empresa</th>
                            <th>Empleado</th>
                            <th>ID Empleado</th>
                            <th>Diagn√≥stico</th>
                            <th>Inicio</th>
                            <th>Fin</th>
                            <th>Estado</th>
                            <th>Archivos</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Incapacidad En Proceso -->
                        <tr>
                            <td>1</td>
                            <td>Empresa ABC S.A.S.</td>
                            <td>Juan P√©rez</td>
                            <td>1234567890</td>
                            <td>Gripe Com√∫n</td>
                            <td>2025-11-20</td>
                            <td>2025-11-23</td>
                            <td><span class="badge badge-status-en-proceso">En Proceso</span></td>
                            <td>2</td>
                            <td>
                                <button class="btn btn-sm btn-icon btn-outline-info" title="Ver Detalle"><i data-feather="eye"></i></button>
                                <button class="btn btn-sm btn-icon btn-outline-danger" title="Rechazar"><i data-feather="x-circle"></i></button>
                                <button class="btn btn-sm btn-icon btn-outline-success" title="Marcar como Pagada"><i data-feather="check-circle"></i></button>
                            </td>
                        </tr>
                        
                        <!-- Incapacidad Pagada -->
                        <tr>
                            <td>2</td>
                            <td>Compa√±√≠a XYZ Ltda.</td>
                            <td>Mar√≠a G√≥mez</td>
                            <td>9876543210</td>
                            <td>Fractura de Tobillo</td>
                            <td>2025-11-10</td>
                            <td>2025-11-25</td>
                            <td><span class="badge badge-status-pagada">Pagada</span></td>
                            <td>3</td>
                            <td>
                                <button class="btn btn-sm btn-icon btn-outline-info" title="Ver Detalle"><i data-feather="eye"></i></button>
                            </td>
                        </tr>
                        
                        <!-- Incapacidad RECHAZADA - Con bot√≥n de escalar -->
                        <tr class="table-danger" style="background-color: #f8d7da;">
                            <td>3</td>
                            <td>Industrias DEF S.A.</td>
                            <td>Carlos Rodr√≠guez</td>
                            <td>5551234567</td>
                            <td>Hernia Discal L5-S1</td>
                            <td>2025-11-01</td>
                            <td>2025-11-15</td>
                            <td><span class="badge badge-status-rechazada">Rechazada</span></td>
                            <td>4</td>
                            <td>
                                <button class="btn btn-sm btn-icon btn-outline-info" title="Ver Detalle"><i data-feather="eye"></i></button>
                                <button class="btn-escalar-tutela" onclick="testEscalarATutela(3)" title="Escalar a Tutela Jur√≠dica">
                                    <i data-feather="shield"></i> Escalar a Tutela
                                </button>
                            </td>
                        </tr>
                        
                        <!-- Otra Incapacidad RECHAZADA -->
                        <tr class="table-danger" style="background-color: #f8d7da;">
                            <td>4</td>
                            <td>Servicios GHI S.A.S.</td>
                            <td>Ana Mart√≠nez</td>
                            <td>7778889990</td>
                            <td>Estr√©s Postraum√°tico</td>
                            <td>2025-10-15</td>
                            <td>2025-10-30</td>
                            <td><span class="badge badge-status-rechazada">Rechazada</span></td>
                            <td>1</td>
                            <td>
                                <button class="btn btn-sm btn-icon btn-outline-info" title="Ver Detalle"><i data-feather="eye"></i></button>
                                <button class="btn-escalar-tutela" onclick="testEscalarATutela(4)" title="Escalar a Tutela Jur√≠dica">
                                    <i data-feather="shield"></i> Escalar a Tutela
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="alert alert-info mt-4">
                <strong>‚ÑπÔ∏è Nota:</strong> El bot√≥n p√∫rpura "Escalar a Tutela" aparece <strong>√∫nicamente</strong> en incapacidades con estado <strong>"Rechazada"</strong>.
            </div>
        </div>
        
        <!-- Log de Acciones -->
        <div class="demo-card p-4 mt-4">
            <h5 class="mb-3">üìã Log de Acciones</h5>
            <div id="actionLog" class="bg-light p-3 rounded" style="font-family: monospace; font-size: 0.875rem; max-height: 300px; overflow-y: auto;">
                <p class="text-muted">Las acciones se mostrar√°n aqu√≠...</p>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Feather Icons -->
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
    <script>
        // Inicializar Feather Icons
        feather.replace();
        
        // Datos simulados de incapacidades
        const incapacidadesSimuladas = [
            { id: 1, estado: 'En Proceso', empleado: 'Juan P√©rez', empresa: 'Empresa ABC S.A.S.', usuario_id: '1234567890', empresa_nit: '900111222', diagnostico: 'Gripe Com√∫n', fecha_inicio: '2025-11-20', fecha_fin: '2025-11-23' },
            { id: 2, estado: 'Pagada', empleado: 'Mar√≠a G√≥mez', empresa: 'Compa√±√≠a XYZ Ltda.', usuario_id: '9876543210', empresa_nit: '900333444', diagnostico: 'Fractura de Tobillo', fecha_inicio: '2025-11-10', fecha_fin: '2025-11-25' },
            { id: 3, estado: 'Rechazada', empleado: 'Carlos Rodr√≠guez', empresa: 'Industrias DEF S.A.', usuario_id: '5551234567', empresa_nit: '900555666', diagnostico: 'Hernia Discal L5-S1', fecha_inicio: '2025-11-01', fecha_fin: '2025-11-15' },
            { id: 4, estado: 'Rechazada', empleado: 'Ana Mart√≠nez', empresa: 'Servicios GHI S.A.S.', usuario_id: '7778889990', empresa_nit: '900777888', diagnostico: 'Estr√©s Postraum√°tico', fecha_inicio: '2025-10-15', fecha_fin: '2025-10-30' }
        ];
        
        // Funci√≥n de prueba para escalar a tutela
        function testEscalarATutela(incapacidadId) {
            const logDiv = document.getElementById('actionLog');
            
            // Buscar la incapacidad
            const incapacidad = incapacidadesSimuladas.find(inc => inc.id === incapacidadId);
            
            if (!incapacidad) {
                addLog('‚ùå Error: Incapacidad no encontrada', 'danger');
                return;
            }
            
            if (incapacidad.estado !== 'Rechazada') {
                addLog('‚ö†Ô∏è Solo se pueden escalar incapacidades rechazadas', 'warning');
                return;
            }
            
            // Confirmar acci√≥n
            const confirmar = confirm(
                `¬øDeseas escalar esta incapacidad rechazada a una Tutela Jur√≠dica?\n\n` +
                `Empleado: ${incapacidad.empleado}\n` +
                `Empresa: ${incapacidad.empresa}\n` +
                `Diagn√≥stico: ${incapacidad.diagnostico}\n\n` +
                `Se crear√° un nuevo registro de tutela con estos datos.`
            );
            
            if (!confirmar) {
                addLog('‚è∏Ô∏è Acci√≥n cancelada por el usuario', 'secondary');
                return;
            }
            
            // Preparar par√°metros URL
            const params = new URLSearchParams({
                new_from_incapacidad: incapacidadId,
                usuario_id: incapacidad.usuario_id,
                empresa_nit: incapacidad.empresa_nit,
                motivo: `Rechazo de Incapacidad - ${incapacidad.diagnostico}`,
                descripcion: `Incapacidad rechazada del ${incapacidad.fecha_inicio} al ${incapacidad.fecha_fin}. Diagn√≥stico: ${incapacidad.diagnostico}.`,
                origen: 'incapacidad',
                origen_id: incapacidadId
            });
            
            // Log de datos transferidos
            addLog(`‚úÖ Escalando incapacidad #${incapacidadId} a tutela jur√≠dica`, 'success');
            addLog(`üìã Datos de transferencia:`, 'info');
            addLog(`   - Usuario ID: ${incapacidad.usuario_id}`, 'info');
            addLog(`   - Empresa NIT: ${incapacidad.empresa_nit}`, 'info');
            addLog(`   - Diagn√≥stico: ${incapacidad.diagnostico}`, 'info');
            addLog(`   - Periodo: ${incapacidad.fecha_inicio} al ${incapacidad.fecha_fin}`, 'info');
            
            // Mostrar URL de redirecci√≥n
            const targetUrl = `/tutelas?${params.toString()}`;
            addLog(`üîó URL de redirecci√≥n generada:`, 'primary');
            addLog(`   ${targetUrl}`, 'primary');
            
            // En producci√≥n, aqu√≠ se har√≠a la redirecci√≥n:
            // window.location.href = targetUrl;
            
            addLog(`‚ú® En producci√≥n, se redirigir√≠a al m√≥dulo de tutelas con los par√°metros`, 'success');
        }
        
        // Funci√≥n auxiliar para agregar logs
        function addLog(message, type = 'info') {
            const logDiv = document.getElementById('actionLog');
            const timestamp = new Date().toLocaleTimeString('es-CO');
            
            // Limpiar mensaje inicial si existe
            if (logDiv.querySelector('.text-muted')) {
                logDiv.innerHTML = '';
            }
            
            const colorMap = {
                success: '#28a745',
                danger: '#dc3545',
                warning: '#ffc107',
                info: '#17a2b8',
                primary: '#007bff',
                secondary: '#6c757d'
            };
            
            const logEntry = document.createElement('div');
            logEntry.style.color = colorMap[type] || '#000';
            logEntry.style.marginBottom = '0.25rem';
            logEntry.innerHTML = `<span style="color: #999;">[${timestamp}]</span> ${message}`;
            
            logDiv.appendChild(logEntry);
            
            // Auto-scroll al final
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        // Log inicial
        addLog('üöÄ Sistema de prueba iniciado', 'success');
        addLog('üëÜ Haz clic en "Escalar a Tutela" en las filas rechazadas', 'info');
    </script>
</body>
</html>
